{% extends 'base.html' %}

{% block content %}
<h2 class="mb-4">사용자 관리</h2>

<form method="get" class="mb-4">
    <div class="input-group">
        <input type="text" class="form-control" name="search" placeholder="사용자명 또는 이메일 검색" value="{{ search_query }}">
        <button class="btn btn-primary" type="submit">검색</button>
    </div>
</form>

<table class="table table-striped">
    <thead>
        <tr>
            <th>사용자명</th>
            <th>이메일</th>
            <th>대화 수</th>
            <th>가입일</th>
            <th>관리자</th>
            <th>작업</th>
        </tr>
    </thead>
    <tbody>
        {% for user in page_obj %}
        <tr>
            <td>{{ user.username }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.chat_count }}</td>
            <td>{{ user.date_joined|date:"Y-m-d" }}</td>
            <td>
                {% if user.is_staff %}
                <span class="badge bg-success">관리자</span>
                {% else %}
                <span class="badge bg-secondary">일반</span>
                {% endif %}
            </td>
            <td>
                <form method="post" action="{% url 'admin_toggle_staff' user.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button class="btn btn-sm btn-warning" type="submit">
                        {% if user.is_staff %}제거{% else %}부여{% endif %}
                    </button>
                </form>
                <a href="{% url 'admin_chat_logs' %}?user_id={{ user.id }}" class="btn btn-sm btn-info">대화 이력</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<nav>
    <ul class="pagination">
        {% if page_obj.has_previous %}
        <li class="page-item"><a class="page-link" href="?page=1">처음</a></li>
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">이전</a></li>
        {% endif %}
        <li class="page-item active"><span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span></li>
        {% if page_obj.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">다음</a></li>
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">마지막</a></li>
        {% endif %}
    </ul>
</nav>
{% endblock %}
